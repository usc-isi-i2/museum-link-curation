<!DOCTYPE html>
<html>
    <head>
        <title>Curation Dashboard</title>
        <link rel="stylesheet" type="text/css" href="static/css/cards.css">
        <link rel="stylesheet" type="text/css" href="static/css/style.css">
        <link href="static/css/bootstrap.min.css" rel="stylesheet">
        <script src="https://ajax.googleapis.com/ajax/libs/jquery/1.12.0/jquery.min.js"></script>
        <style>
            html, body, .filter-section, .cards{
                margin: 0;

                padding: 0;

                min-width: 100%;
                width: 100%;
                max-width: 100%;

                min-height: 220%;
                height: 220%;
                max-height: 220%;
            }
        </style>
        <script type="text/javascript">
               $(".close").click(function(){
                   console.log("Close Button")
                    console.log($( this ).css("display"));
                });

                var sv = '{{server}}'.concat("v1/question?stats=true&count=10")
                $.ajax({
                    type: "GET",
                    url: sv,
                    success: function(data){
                        console.log(data.length);
                        for(i = 0; i < data.length; i++)
                        {
                            console.log(data[i]);
                            populateCard(data[i],i);
                        }
                    }
                });

            function populateExactMatch(data, divid) {
                var tr = "";
                var names = data.name;
                var values = data.value;

                if(names.length == 0){
                    tr += "<td>None of the records matched</td>";
                }
                for(var index in names) {
                    tr += "<tr>"
                    nametrim = names[index].replace("schema:",'');
                    tr += "<td>" + nametrim + "</td>";

                    if(names[index] == "schema:birthPlace") {
                        tr += "<td>Name: " + values[index]['schema:name'] + "</td>";
                    }

                    else if(nametrim == "URI"){
                        tr += "<td><a target='_blank' href='" + values[index] + "'>" + lValues[index] + "</a></td>";
                    }
                    else {
                        if(nametrim == "name"){
                            var name_header = document.getElementById("name_header" + divid);
                            name_header.innerHTML = "<table class = 'center-align'><tr><th>SAAM, ULAN</th></tr><tr><td>" + values[index] + "</td></tr></table>"
                        }
                        tr += "<td>" + values[index] + "</td>";
                    }
                    tr += "<td></td>";
                    tr += "</tr>";
                }
                document.getElementById("exactMatch" + divid).innerHTML = tr;
                console.log(document.getElementById("cards"));
            }

            function populateNoMatch(data, divid) {
                var names = data.name;
                var lValues = data.lValue;
                var rValues = data.rValue;

                var tr = "";
                for(var index in names) {

                    tr += "<tr>"
                    nametrim = names[index].replace("schema:",'');
                    tr += "<td class='right_align'>" + nametrim + "</td>";

                    if(names[index] == "schema:birthPlace") {
                        tr += "<td>Name: " + lValues[index]['schema:name'] + "</td>";
                        tr += "<td>Geo: Lat: " + rValues[index]['schema:geo']['schema:latitude'] + " Long: " + rValues[index]['schema:geo']['schema:longitude']+  "<br/>Name: " + rValues[index]['schema:name'] + "</td>";
                    }
                     else if(nametrim == "URI"){
                        tr += "<td><a target='_blank' href='" + lValues[index] + "'>" + lValues[index] + "</a></td>";
                        tr += "<td><a target='_blank' href='" + rValues[index] + "'>" + rValues[index] + "</a></td>";
                    }
                    else {
                        if(nametrim == "name"){
                            var name_header = document.getElementById("name_header" + divid);
                            name_header.innerHTML = "<table class = 'center-align'><tr><th style='text-align:center'>SAAM</th><th style='text-align:center'>ULAN</th></tr><tr><td style='text-align:center'>" + lValues[index] + "</td><td  style='text-align:center'>" + rValues[index] + "</td></tr></table>"
                        }

                        if(lValues[index] == null)
                            tr += "<td>" + "-" + "</td>";
                        else
                            tr += "<td>" + lValues[index] + "</td>";
                        if(rValues[index] == null)
                            tr += "<td>" + "-" + "</td>";
                        else
                            tr += "<td>" + rValues[index] + "</td>";
                    }
                    tr += "</tr>";
                }
                document.getElementById("noMatch" + divid).innerHTML = tr;
                console.log(document.getElementById("cards"));
            }

            function populateCard(data,divid) {
                $.ajax({
                    method: "GET",
                    url: "/cards",
                    success: function (card) {
                        content = card;
                        searchTxt = "<h2 id='name_header";
                        pos = content.search(searchTxt);
                        content = content.slice(0, pos + searchTxt.length) + divid + content.slice(pos + searchTxt.length);
                        searchTxt = "<div id ='";
                        pos = content.search(searchTxt);
                        content = content.slice(0, pos + searchTxt.length) + divid + content.slice(pos + searchTxt.length);
                        searchTxt = "<tbody class = 'exactMatch' id ='";
                        pos = content.search(searchTxt);
                        content = content.slice(0, pos + searchTxt.length) + "exactMatch" + divid + content.slice(pos + searchTxt.length);
                        searchTxt = "<tbody class = 'noMatch' id ='";
                        pos = content.search(searchTxt);
                        content = content.slice(0, pos + searchTxt.length) + "noMatch" + divid + content.slice(pos + searchTxt.length);
                        searchTxt = "'1','";
                        pos = content.search(searchTxt);
                        content = content.slice(0, pos + searchTxt.length) + data['qid'] + content.slice(pos + searchTxt.length);
                        searchTxt = "'2','";
                        pos = content.search(searchTxt);
                        content = content.slice(0, pos + searchTxt.length) + data['qid'] + content.slice(pos + searchTxt.length);
                        searchTxt = "'3','";
                        pos = content.search(searchTxt);
                        content = content.slice(0, pos + searchTxt.length) + data['qid'] + content.slice(pos + searchTxt.length);

                        document.getElementById("cards").innerHTML += content;
                        console.log(document.getElementById("cards"));
                        console.log("Data parsed:")
                        console.log(data);

                    },
                    complete: function () {
                        populateExactMatch(data.ExactMatch, divid);
                        populateNoMatch(data.Unmatched, divid);
                    }
                });
            }
            function submitAnswer(value, qid){
                var sv = '{{server}}'.concat("/v1/answer");

                var answerObj = new Object();
                answerObj.qid = qid;
                answerObj.value = parseInt(value);
                answerObj.comment = "NONE";
                json_ans = JSON.stringify(answerObj)

                $.ajax({
                    method: "PUT",
                    url: sv,
                    data: '{"qid":"' +  qid + '", "value": 1, "comment":"BLAH"}',
                    contentType: 'application/json',
                    success: function(data){
                        console.log("Answer Successfully submitted");
                    }
                });
            }
       </script>

</head>
    <body>
        <div class="page" id="page">
        <div class="filter-section">
             <div id = "header">{% include 'header_search.html' %}</div>
        </div>
        <div class="cards" id = "cards"></div>
        </div>
    </body>
</html>